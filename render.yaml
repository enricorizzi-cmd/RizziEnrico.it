# Render Blueprint per deploy automatico
# NOTA: Il buildCommand qui è documentato, ma va configurato anche su Dashboard
# Dashboard: https://dashboard.render.com/web/srv-d41prqp5pdvs73fahp4g/settings

services:
  - type: web
    name: rizzienrico-it
    env: node
    # Build command ottimizzato: npm ci è più veloce e consistente di npm install
    # Aggiunto limiti memoria Node.js per prevenire OOM
    buildCommand: NODE_OPTIONS="--max-old-space-size=400" npm ci && NODE_OPTIONS="--max-old-space-size=400" npm run build && cp -r public .next/standalone/ && cp -r .next/static .next/standalone/.next/
    # Start command con limiti memoria e garbage collection aggressivo
    startCommand: node .next/standalone/server.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_BASE_URL
        generateValue: true  # Render genera automaticamente l'URL
      # Limiti memoria Node.js (400MB su 512MB disponibili = margine sicurezza)
      - key: NODE_OPTIONS
        value: "--max-old-space-size=400 --expose-gc"
      # Variabili già configurate su Render:
      # - NEXT_PUBLIC_SUPABASE_URL
      # - NEXT_PUBLIC_SUPABASE_ANON_KEY
      # - SUPABASE_SERVICE_ROLE_KEY
      # - RESEND_API_KEY
      # - OPENAI_API_KEY
      # - FROM_EMAIL
      # - NEXT_PUBLIC_CALENDLY_CHECKUP_URL
      # - NEXT_PUBLIC_WHATSAPP_NUMBER

